問題：Line 11以上使用該功能分享好友會把網址https變成http

https://developers.line.biz/en/docs/messaging-api/using-line-url-scheme/#available-line-url-schemes

```
window.location = "https://line.me/R/msg/text/?"+message;
```

![image](https://user-images.githubusercontent.com/17564628/111759427-87f18d00-88d8-11eb-99b2-f822ca8b7c30.png)



![image](https://user-images.githubusercontent.com/17564628/111761258-ac4e6900-88da-11eb-9215-5ad1cde258b3.png)


```
<script>
    window.onload = function () {
        liff
            .init({
                liffId: liffId
            })
            .then(() => {
                initLIFF();
            })
            .catch((error) => {
                //alert(error.message);
            });
    }
    
    function initLIFF() {
        //版本需10.3以上
        const [majorVer, minorVer] = (liff.getLineVersion() || "").split('.');
        if (parseInt(majorVer) < 10 || (parseInt(majorVer) == 10 && parseInt(minorVer) < 3 )  ) { //Line版本需10.3以上
            alert('請更新Line版本');
            return;
        }
    }
</script>
```
```
<script>
//分享訊息給別人
function liff_shareTargetPicker(messages) {
    if (liff.isApiAvailable('shareTargetPicker')) {
        liff.shareTargetPicker(
            messages
        )
            .then(function (res) {
                if (res) {
                    // succeeded in sending a message through TargetPicker
                    console.log(`[${res.status}] Message sent!`)
                } else {
                    const [majorVer, minorVer] = (liff.getLineVersion() || "").split('.');
                    if (parseInt(majorVer) == 10 && parseInt(minorVer) < 11) {
                        // LINE 10.3.0 - 10.10.0
                        // Old LINE will access here regardless of user's action
                        console.log('TargetPicker was opened at least. Whether succeeded to send message is unclear')
                    } else {
                        // LINE 10.11.0 -
                        // sending message canceled
                        console.log('TargetPicker was closed!')
                    }
                }
            }).catch(function (error) {
            // something went wrong before sending a message
            console.log('something wrong happen')
        })
    }
    else {
        alert('請更新Line版本');
    }
}


//分享訊息給別人
function command_line_msg(message) {
    //window.location = "https://line.me/R/msg/text/?"+message;
    if (liff.isApiAvailable('shareTargetPicker')) {
        liff.shareTargetPicker([
            {
                'type': 'text',
                'text': message
            }
        ])
            .then(function (res) {
                if (res) {
                    // succeeded in sending a message through TargetPicker
                    console.log(`[${res.status}] Message sent!`)
                } else {
                    const [majorVer, minorVer] = (liff.getLineVersion() || "").split('.');
                    if (parseInt(majorVer) == 10 && parseInt(minorVer) < 11) {
                        // LINE 10.3.0 - 10.10.0
                        // Old LINE will access here regardless of user's action
                        console.log('TargetPicker was opened at least. Whether succeeded to send message is unclear')
                    } else {
                        // LINE 10.11.0 -
                        // sending message canceled
                        console.log('TargetPicker was closed!')
                    }
                }
            }).catch(function (error) {
            // something went wrong before sending a message
            console.log('something wrong happen')
        })
    }
    else {
        alert('請更新Line版本');
    }
}
</script>
```


![image](https://user-images.githubusercontent.com/17564628/111764168-e3724980-88dd-11eb-80a4-e95ea506b8a1.png)



使用方式：中獎後直接打API即可

1.中獎數量上限：每個獎品在產品優惠卷皆有一個人最多只能中幾次的上限，藉此做獎品發放的管控，比如美好時光抽獎卷一個人最多只能中35次，所以在遊戲端部分也要把美好時光抽獎卷設定成一個人最多只能中35次

2.一定要使用PHP來打API，使用Jquery打API有網址外流的風險

3.打API後回傳時間約1.5~3秒，網路太慢或手機老舊也會影響執行速度，所以在中獎的時候要做個Loading的畫面，避免讓使用者覺得程式當機

4.後台產品組優惠卷介面目前不支援清空的選項，因此若要清空測試的數據請提前告知產品組PM

5.依照需求可能需要請產品組客制API，比如寶雅這次需求是要把獎項都放在同一個選項裡，需花時間客制
![image](https://user-images.githubusercontent.com/17564628/111763955-a73ee900-88dd-11eb-83df-5ffeeedcf7bb.png)
